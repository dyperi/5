name: 'W-Extend'

on:
  #push:
  schedule:
    # UTC time (国内 UTC+8)
     - cron: '30 4 */3 * *'
  # Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:

jobs:
  build:
    #runs-on: macos-latest
    runs-on: macos-12
    #runs-on: macos-10.15

    steps:
        - name: 'Checkout codes'
          uses: actions/checkout@v2
        - name: 'Set up chromedriver'           
          uses: nanasess/setup-chromedriver@v1
          with:
    # Optional: do not specify to match Chrome's version
            chromedriver-version: '100'
        - run: |
            export DISPLAY=:99
            chromedriver --url-base=/wd/hub &
            sudo Xvfb -ac :99 -screen 0 1280x1024x24 > /dev/null 2>&1 & # optional

        - name: 'Install requirements'
          run: |
            pip3 install -r ./requirements.txt
            pip3 install undetected-chromedriver
            
        - name: 'Working'
          env:
            USER_ID: ${{ secrets.USER_ID }}
            PASS_WD: ${{ secrets.PASS_WD }}
            BARK_KEY: ${{ secrets.BARK_KEY }}
            TG_BOT_TOKEN: ${{ secrets.TG_BOT_TOKEN }}
            TG_USER_ID: ${{ secrets.TG_USER_ID }}

          run: |
            python3 ./main-w.py
